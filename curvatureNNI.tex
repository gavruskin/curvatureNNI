\documentclass{amsart}

\synctex=1

\usepackage{amsmath,amsthm}
\usepackage{todonotes}
\usepackage[notref,notcite]{showkeys} % show keys for eqs, etc.
\usepackage{cite}
\usepackage{enumerate}
\usepackage[colorlinks=true]{hyperref}

\newtheorem{lemma}{Lemma}
\newtheorem{question}{Question}
\newtheorem{proposition}{Proposition}

\newcommand{\tN}{\mathrm{\tau NNI}}

\begin{document}

\section{Introduction}

In this paper we study the curvature of Markov chains on phylogenetic trees. 
We see different spaces of phylogenetic trees as graphs, where the adjacency 
relation is given by a tree move and the distance is inherited from the graph.
We every such a graph we associate a Markov chain, that is, a proposal 
mechanism, that is, a functional $m$ that maps vertices of the graph to the
set of measures on this graph. In other words, for every vertex $v$, $m_v(w)$
is the (probability) measure of getting from $v$ to $w$ in one step. 

We consider a number of Markov chains that arise in phylogenetic Bayesian 
inference and investigate the curvature of those chains with an eye towards 
the efficiency properties of the corresponding inference methods. 

\section{Discrete $\tau$-space}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We consider the ranked-NNI graph (the distance on ranked topologies inherited 
from $\tau$-space). 

\begin{lemma}
Let $T$ be a ranked tree on $n>2$ leaves. Then \[n-1\leq \deg(T)\leq2(n-2).\] 
\end{lemma}

\proof
Obvious. 
\endproof

\begin{lemma}
\begin{enumerate}[(1)]
\item $deg(T)-deg(R) \leq n-3.$
\item $\dfrac{\deg(T)}{deg(R)}>\dfrac12.$
\item $\lim\limits_n\dfrac{\deg(T)}{deg(R)}=\dfrac{1}{2}.$
\end{enumerate}
\end{lemma}

\proof
Follows from previous Lemma. 
\endproof

\begin{lemma}
$d_{\tau}(T,R) = 1 \Rightarrow |N_1(T)\cap N_1(R)|\in\{0,1\}.$
\end{lemma}

\proof
Obvious.
\endproof

\begin{lemma}
Under a distance-one random walk, the following is true for any finite 
metric $d$ and any pair of points $x,y$:
\[
\dfrac{-2}{d(x,y)} \leq \kappa(x,y) \leq \dfrac{2}{d(x,y)}.
\]
\end{lemma}

\proof
Obvious, assuming the measure of any point is bounded by one. 
\endproof


\begin{lemma}
The curvature of a uniform random walk on the discrete $\tau$-space satisfies 
\[
\kappa_{d\tau}(T,R) \leq 
\dfrac{1}{2(n-2)}.
\]
\end{lemma}

\proof
Follows from Lemma~5.2 in~\cite{WhiddenMatsen}. 
\endproof

What does this Lemma say about full and topological $\tau$-spaces? 
In full $\tau$-space, $\kappa(T,R) \leq 0$~\cite{GD} for some random walk. 
For which one? 

\begin{lemma}
\begin{enumerate}
\item The curvature of the $p$-lazy uniform random walk on the, the NNI
graph, the $\tau$-graph, and the discrete $\tau$-space on rooted trees with 
$n$ leaves is bounded from below by $-\displaystyle\frac{3p}{n-2}.$
\item Subtract $2/3$ to get a lower bound on the curvature of the
uniform prior Metropolis-Hastings random walk.
\end{enumerate}
\end{lemma}

\proof
(1) Let $T$ and $S$ be two NNI-adjacent trees. There are at most $8$ unpairable 
trees in $N_1(T)$ and one tree in the intersection $N_1(T) \cap N_1(S)$. The
total number of elements of $N_1(T)$ is $2(n-2).$
Hence, 
\[
W_1(m_T,m_S)\leq (1 - p - \frac{p}{2(n - 2)}) + 
8 \cdot 2 \cdot \frac{p}{2(n - 2)} +
(2(n - 2) - 9)\frac{p}{2(n-2)} =
\]
$1 + \displaystyle\frac{3p}{n-2}.$ 
Hence, $1 - W_1(m_T,m_S) \leq - \displaystyle\frac{3p}{n-2}.$

(2) Same reasoning as in~\cite{WhiddenMatsen}. 
\endproof

\begin{proposition}
Let $(\mathcal G_n)_{n \in \omega}$ be a sequence of finite graphs and 
$(x_n, y_n)$ a sequence of adjacent vertices from $\mathcal G_n$ such that
\begin{enumerate}[(1)]
\item $\big|N(x_n) \cap N(y_n)\big| = o(|N(x_n)|).$ 
\item $\big||N(x_n)| - |N(y_n)|\big| = o(|N(x_n)|).$ 
\item $\big|\{(x,y) \mid x \in N(x_n),~ y \in N(y_n),~ d(x, y) \geq 2\}\big| 
= o(|N(x_n)|).$
\end{enumerate}

Then $\lim\limits_{n \to \infty} \kappa(x_n, y_n) = 0.$
\end{proposition}

\proof

\endproof

\begin{question}
Assume some (e.g.\ uniform, lazy, ...) random walk. What are the $m$ and $M$ 
such that 
\[
m(\deg x,\deg y, \ldots) \leq \kappa(x,y) \leq M(\deg x, \deg y, \ldots)? 
\]
\end{question}

\section{Full $\tau$-space}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We now extend the space of possible moves by including branch length moves. 
In general, such moves should allow the branch length to be any positive real 
number, but this setting seems to require quite sophisticated techniques for 
computing the curvature and hence is a direction of future research. 
Instead, here we allow branch length (or rather $\tau$- coordinates) 
to be of two possible values: long (denoted by $\Lambda$) and short (denoted 
by $\lambda$). Node that the number of possible `branch lengths' can be 
generalised to any finite set $\lambda_1,\ldots,\lambda_s$\todo{It's worth 
pointing out explicitly what the change in what result will be.}.

More precisely, we consider a graph $\tN$ on the set of ranked rooted tree 
topologies (which we call simply trees from now on) with all leaves of rank 
$0$ and all intervals between nodes of the tree marked by $\Lambda$ or
$\lambda$. Two trees are adjacent in $\tN$ if and only if they are in 
adjacent orthants in $\tau$-space~\cite{GD} and the interval corresponding 
to the boundary in $\tau$-space is marked by $\lambda$ in both trees, 
or they are of the same ranked topology and there 
exists precisely one interval which is marked by different symbols in 
the two trees. 

The intuition behind this notion is that one move corresponds to either 
a $\tau$-move from a short interval to a new short interval or a change 
of the length of precisely one interval. 

First, we consider a uniform (lazy) random walk, where given a tree $T$ 
we do nothing with probability $p$, where $0\leq p\leq 1$ is the probability of 
\href{https://academichelp.net/wp-content/uploads/2014/01/laziness.jpg}{laziness},
and uniformly move to a neighbouring tree with probability $1-p$. 

\begin{lemma}
Let $T$ be a ranked tree on $n>2$ leaves. Then \[n-2\leq \deg(T)\leq3(n-2).\] 
\end{lemma}

\proof
Obvious.
\endproof

\begin{lemma}
\begin{enumerate}[(1)]
\item $deg(T)-deg(R) \leq 2(n-2).$
\item $\min\limits_{T,R}\dfrac{\deg(T)}{deg(R)} = \dfrac13$ for all $n.$
\end{enumerate}
\end{lemma}

\proof
Follows from previous Lemma. 
\endproof

These two lemmas remain unchanged if we increase the number of branch lengths. 

Other lemmas follow similarly too. 

Several important proposal mechanisms used in phylogenetic Bayesian inference by 
popular software packages such as BEAST2~\cite{beast2} favour topological moves
or tree moves depending on various conditions. All tree moves I have been 
considering so far do not make an explicit distinction between topological 
changes and branch length changes. To address this issue, we consider the
following tree move that explicitly allows distributing the acceptance 
probability between topological and branch length moves. 

{\bf Lazy walk.} Let $p$ be a laziness probability, that is, we do nothing 
with probability $p$ and distribute the rest of probability $1-p$ as follows. 
We decide first on what type of move we want to perform: choose a topological 
move with probability $q$ and a length move otherwise, that is, $q \leq 1-p$
and the probability of a length move is $1-p-q$. The proposal is rejected if
a topological move is impossible. 

{\bf tau move.} Choose a coordinate uniformly at random. Increase the
coordinate by $1$ with probability $p$ and decrease it by $1$ otherwise.
If the coordinate becomes $0$, resolve the multifurcation uniformly at
random and set the new coordinate to $1$. Note that this mechanism 
does not bound edge lengths from above favours topological moves when 
$p<1/2$. 

{\bf MH lazy walk.} Propose a tree in the one-neighbourhood uniformly at random. 
Accept the proposal with probability 
$\min(1, \dfrac{|N_1(T_{old})|}{|N_1(T_{new})|})$. 

\end{document}
